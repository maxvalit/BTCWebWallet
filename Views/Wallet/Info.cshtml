@using BTCWebWallet.Controllers
@using BTCWebWallet.Helpers
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer

@{
    ViewData["Title"] = Localizer["Wallet"] + " " + Model?.WalletInfo?.Walletname;
}

@model WalletViewModel

@if (Model != null && Model.IsSuccess)
{
    <div class="row">
    <div class="col-md-6 col-sm-12">
        <div class="card panel-primary">
            <div class="card-header">@Localizer["Wallet"] <i>@Model.WalletInfo?.Walletname</i></div>
            <div class="card-body">
                <div class="row">

                    @if (Model.WalletInfo?.Unlocked_until > 0)
                        {
                            <div class="col-md-7 text-muted">
                                @Localizer["Unlocked_until"]
                                <div class="small"><i class="bi bi-info-circle"></i> @Localizer["Unlocked_untilDesc"]</div>
                            </div>
                            <div class="col-md-5">@Model.WalletInfo?.Unlocked_until.ToDateTime().ToLocalTime().ToString()</div>
                        }
                        else
                        {
                            <div class="col-12">
                                <div class="row g-3">
                                    <div class="col-auto">
                                        <label for="passphrase" class="visually-hidden">@Localizer["Passphrase"]</label>
                                        <input id="passphrase" type="password" class="form-control"
                                    placeholder="@Localizer["Passphrase"]" required>
                                    </div>
                                    <div class="col-auto">
                                        <button onclick="Unlock();" type="button" class="btn btn-primary mb-3"><i
                                        class="bi bi-unlock"></i> @Localizer["Unlock"]</button>
                                    </div>
                                </div>
                                @* <a class="btn btn-primary" asp-area="" asp-controller="Wallet" asp-action="Unlock"
                                    asp-route-name="@Model.WalletInfo?.Walletname">
                                    <i class="bi bi-unlock"></i> @Localizer["Unlock"]
                                    </a> *@
                            </div>
                        }

                        <div class="col-md-7 text-muted">
                            @Localizer["Version"]
                            <div class="small"><i class="bi bi-info-circle"></i> @Localizer["VersionDesc"]</div>
                        </div>
                        <div class="col-md-5">@Model.WalletInfo?.Walletversion</div>

                        <div class="col-md-7 text-muted">
                            @Localizer["Format"]
                            <div class="small"><i class="bi bi-info-circle"></i> @Localizer["FormatDesc"]</div>
                        </div>
                        <div class="col-md-5">@Model.WalletInfo?.Format</div>

                        <div class="col-md-7 text-muted">
                            @Localizer["Txcount"]
                            <div class="small"><i class="bi bi-info-circle"></i> @Localizer["TxcountDesc"]</div>
                        </div>
                        <div class="col-md-5">@Model.WalletInfo?.Txcount</div>

                        <div class="col-md-7 text-muted">
                            @Localizer["Keypoololdest"]
                            <div class="small"><i class="bi bi-info-circle"></i> @Localizer["KeypoololdestDesc"]</div>
                        </div>
                        <div class="col-md-5">@Model.WalletInfo?.Keypoololdest.ToDateTime().ToLocalTime().ToString()</div>

                        <div class="col-md-7 text-muted">
                            @Localizer["Keypoolsize"]
                            <div class="small"><i class="bi bi-info-circle"></i> @Localizer["KeypoolsizeDesc"]</div>
                        </div>
                        <div class="col-md-5">@Model.WalletInfo?.Keypoolsize</div>

                        <div class="col-md-7 text-muted">
                            @Localizer["Keypoolsize_hd_internal"]
                            <div class="small"><i class="bi bi-info-circle"></i> @Localizer["Keypoolsize_hd_internalDesc"]
                            </div>
                        </div>
                        <div class="col-md-5">@Model.WalletInfo?.Keypoolsize_hd_internal</div>

                        <div class="col-md-7 text-muted">
                            @Localizer["Paytxfee"]
                            <div class="small"><i class="bi bi-info-circle"></i> @Localizer["PaytxfeeDesc"]</div>
                        </div>
                        <div class="col-md-5">@Model.WalletInfo?.Paytxfee</div>

                        <div class="col-md-7 text-muted">
                            @Localizer["Hdseedid"]
                            <div class="small"><i class="bi bi-info-circle"></i> @Localizer["HdseedidDesc"]</div>
                        </div>
                        <div class="col-md-5">@Model.WalletInfo?.Hdseedid</div>

                        <div class="col-md-7 text-muted">
                            @Localizer["Private_keys_enabled"]
                            <div class="small"><i class="bi bi-info-circle"></i> @Localizer["Private_keys_enabledDesc"]
                            </div>
                        </div>
                        <div class="col-md-5">
                            @if (Model.WalletInfo != null && Model.WalletInfo.Private_keys_enabled)
                            {
                                <i class="bi bi-check-lg"></i>
                            }
                            else
                            {
                                <i class="bi bi-x-lg"></i>
                            }
                        </div>

                        <div class="col-md-7 text-muted">
                            @Localizer["Avoid_reuse"]
                            <div class="small"><i class="bi bi-info-circle"></i> @Localizer["Avoid_reuseDesc"]</div>
                        </div>
                        <div class="col-md-5">
                            @if (Model.WalletInfo != null && Model.WalletInfo.Avoid_reuse)
                            {
                                <i class="bi bi-check-lg"></i>
                            }
                            else
                            {
                                <i class="bi bi-x-lg"></i>
                            }
                        </div>

                        @if (Model.WalletInfo != null && Model.WalletInfo.Scanning != null)
                        {
                            <div class="col-md-7 text-muted">
                                @Localizer["Duration"]
                                <div class="small"><i class="bi bi-info-circle"></i> @Localizer["DurationDesc"]</div>
                            </div>
                            <div class="col-md-5">@Model.WalletInfo.Scanning.DurationAsTimeSpan.ToString()</div>

                            <div class="col-md-7 text-muted">
                                @Localizer["Progress"]
                                <div class="small"><i class="bi bi-info-circle"></i> @Localizer["ProgressDesc"]</div>
                            </div>
                            <div class="col-md-5">
                                <div class="progress">
                                    <div class="progress-bar" style="width: @(Model.WalletInfo.Scanning.Progress100)%; role="
                                progressbar" aria-valuenow="@(Model.WalletInfo.Scanning.Progress100)" aria-valuemin="0"
                                aria-valuemax="100"></div>
                                </div>
                            </div>
                        }

                        <div class="col-md-7 text-muted">
                            @Localizer["Descriptors"]
                            <div class="small"><i class="bi bi-info-circle"></i> @Localizer["DescriptorsDesc"]</div>
                        </div>
                        <div class="col-md-5">
                            @if (Model.WalletInfo != null && Model.WalletInfo.Descriptors)
                            {
                                <i class="bi bi-check-lg"></i>
                            }
                            else
                            {
                                <i class="bi bi-x-lg"></i>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6 col-sm-12">
            <div class="card panel-primary">
                <div class="card-header">@Localizer["Balances"]</div>
                <div class="card-body">
                    <div class="row">
                        
                        @if (Model.Balances != null && Model.Balances.Mine != null)
                        {
                            <div class="col-12">
                                <h4>@Localizer["Mine"]</h4>
                                <small class="text-muted"><i class="bi bi-info-circle"></i> @Localizer["MineDesc"]</small>
                            </div>
                            <div class="col-md-7 text-muted">
                                @Localizer["Trusted"]
                                <div class="small"><i class="bi bi-info-circle"></i> @Localizer["TrustedDesc"]</div>
                            </div>
                            <div class="col-md-5">@Model.Balances.Mine.Trusted</div>
                            <div class="col-md-7 text-muted">
                                @Localizer["Untrusted_pending"]
                                <div class="small"><i class="bi bi-info-circle"></i> @Localizer["Untrusted_pendingDesc"]</div>
                            </div>
                            <div class="col-md-5">@Model.Balances.Mine.Untrusted_pending</div>
                            <div class="col-md-7 text-muted">
                                @Localizer["Immarute"]
                                <div class="small"><i class="bi bi-info-circle"></i> @Localizer["ImmaruteDesc"]</div>
                            </div>
                            <div class="col-md-5">@Model.Balances.Mine.Immarute</div>
                            @if (Model?.WalletInfo?.Avoid_reuse == true)
                            {
                                <div class="col-md-7 text-muted">
                                    @Localizer["Used"]
                                    <div class="small"><i class="bi bi-info-circle"></i> @Localizer["UsedDesc"]</div>
                                </div>
                                <div class="col-md-5">@Model.Balances.Mine.Used</div>
                            }
                        }

                        @if (Model != null && Model.Balances != null && Model.Balances.Watchonly != null) 
                        {
                            <div class="col-12">
                                <h4>@Localizer["Watchonly"]</h4>
                                <small class="text-muted"><i class="bi bi-info-circle"></i> @Localizer["WatchonlyDesc"]</small>
                            </div>
                            <div class="col-md-7 text-muted">
                                @Localizer["Trusted"]
                                <div class="small"><i class="bi bi-info-circle"></i> @Localizer["TrustedDesc"]</div>
                            </div>
                            <div class="col-md-5">@Model.Balances.Watchonly.Trusted</div>
                            <div class="col-md-7 text-muted">
                                @Localizer["Untrusted_pending"]
                                <div class="small"><i class="bi bi-info-circle"></i> @Localizer["Untrusted_pendingDesc"]</div>
                            </div>
                            <div class="col-md-5">@Model.Balances.Watchonly.Untrusted_pending</div>
                            <div class="col-md-7 text-muted">
                                @Localizer["Immarute"]
                                <div class="small"><i class="bi bi-info-circle"></i> @Localizer["ImmaruteDesc"]</div>
                            </div>
                            <div class="col-md-5">@Model.Balances.Watchonly.Immarute</div>
                        }

                    </div>
                </div>
            </div>
        </div>
    </div>
}

@section scripts {
<script>
    function Unlock() {
        var passphrase = $("#passphrase").val();
        var name = "@Model?.WalletInfo?.Walletname";

        var controllerName = "Wallet";
        var actionName = "@nameof(WalletController.Unlock)";
        var url = `/${controllerName}/${actionName}`;
        var model = {
            passphrase: passphrase,
            name: name,
        };

        $.post(url, model, "json")
            .done(function (result) {
                window.location.reload();
            });
    }
</script>
}