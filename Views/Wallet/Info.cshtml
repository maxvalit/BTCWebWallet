@using BTCWebWallet.Controllers
@using BTCWebWallet.Helpers
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer

@{
    ViewData["Title"] = Localizer["Wallet"] + " " + Model?.WalletInfo?.Walletname;
}

@model WalletViewModel

@if (Model != null && Model.IsSuccess)
{
    <h2><a asp-action="Index">@Localizer["Wallets"]</a> > @Model.WalletInfo?.Walletname</h2>

    <div class="row">
        <div class="col p-1">
            @await Html.PartialAsync("_WalletInfo", Model.WalletInfo)
        </div>
        <div class="col p-1">
            @await Html.PartialAsync("_Balances", Model)
        </div>
        <div class="col-12 p-1">
            @await Html.PartialAsync("_Addresses", Model)
        </div>
        <div class="col-12 p-1">
            @await Html.PartialAsync("_Transactions", Model)
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="addAddressModal" tabindex="-1" aria-labelledby="addAddressModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addAddressModalLabel">@Localizer["AddNewAddress"]</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-1">
                    <label for="txtLabel" class="form-label">@Localizer["Label"]</label>
                    <input id="txtLabel" class="form-control" placeholder='@Localizer["EnterAlabel"]' />
                </div>
                <div class="mb-1">
                    <label for="ddAddressType" class="form-label">@Localizer["Label"]</label>
                    <select id="ddAddressType" class="form-select" placeholder='@Localizer["EnterAlabel"]'>
                        <option value="legacy">legacy</option>
                        <option value="p2sh-segwit">p2sh-segwit</option>
                        <option value="bech32">bech32</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">@Localizer["Close"]</button>
                <button type="button" class="btn btn-primary" onclick="AddNewAddress();">@Localizer["Add"]</button>
            </div>
        </div>
    </div>
</div>
}

@section scripts {
<script>
    function Unlock() {
        var passphrase = $("#passphrase").val();
        var name = "@Model?.WalletInfo?.Walletname";

        var controllerName = "Wallet";
        var actionName = "@nameof(WalletController.Unlock)";
        var url = `/${controllerName}/${actionName}`;
        var model = {
            passphrase: passphrase,
            name: name
        };

        $.post(url, model, "json")
            .done(function (result) {
                window.location.reload();
            });
    }

    function AddNewAddress() {
        var name = "@Model?.WalletInfo?.Walletname";
        var label = $("#txtLabel").val();
        var addressType = $("#ddAddressType").val();

        var controllerName = "Wallet";
        var actionName = "@nameof(WalletController.AddNewAddress)";
        var url = `/${controllerName}/${actionName}`;
        var model = {
            name: name,
            label: label,
            addressType: addressType
        };

        $.post(url, model, "json")
            .done(function (result) {
                window.location.reload();
            });
    }
</script>
}